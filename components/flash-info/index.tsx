"use client";

import React, {useEffect} from 'react';
import {AnimatePresence, motion} from "framer-motion";
import {cn} from "@/lib/utils";
import {useFlashStore} from "@/features/infos-flash/flash.store";

function FlashInfo() {
	const {getActiveFlashInfos} = useFlashStore();
	const activeFlashInfos = getActiveFlashInfos();
	const [activeInfoIndex, setActiveInfoIndex] = React.useState(0);

	const activeInfo = activeFlashInfos[activeInfoIndex] || {id: 0, title: "", body: ""};

	const flashInfoVariants = {
		initial: {opacity: 0, y: -20},
		animate: {opacity: 1, y: 0},
		exit: {opacity: 0, y: 20}
	};

	useEffect(() => {
		const interval = setInterval(() => {
			setActiveInfoIndex((prevIndex) => (prevIndex + 1) % activeFlashInfos.length);
		}, 10 * 1000);

		return () => clearInterval(interval);
	}, [activeFlashInfos]);


	if (activeFlashInfos.length === 0) {
		return null; // Pas d'infos flash actives
	}

	return (
		<motion.div className="bg-custom-gradient text-white py-1 md:py-2 z-10">
			<div className="mx-auto w-full max-w-7xl px-2 sm:px-4 lg:px-6">
				<div className="flex flex-col sm:flex-row items-center justify-between gap-1 sm:gap-3">
					<div className="flex items-center self-start sm:self-auto">
						<h2 className="uppercase font-extrabold text-base sm:text-lg md:text-xl lg:text-2xl w-max pr-3">
							Flash Infos
						</h2>
						<div className="h-6 sm:h-8 md:h-10 lg:h-12 w-0.5 sm:w-1 bg-white"
						     aria-label="Flash Info Indicator"/>
					</div>

					<div className="flex items-center w-full pl-0 sm:pl-3 md:pl-5">
						<LogoWhite className="hidden md:block w-6 h-6 md:w-8 md:h-8 lg:w-10 lg:h-10 flex-shrink-0"/>
						<div
							className="ml-1 sm:ml-2 md:ml-3 text-xs sm:text-sm md:text-base lg:text-lg relative h-6 sm:h-7 overflow-hidden w-full">
							<AnimatePresence>
								<motion.a
									href={activeInfo.link || "#"}
									target="_blank"
									rel="noopener noreferrer"
									key={activeInfo.id}
									className="absolute left-0 top-0 w-full text-ellipsis overflow-hidden truncate flex items-center truncate"
									variants={flashInfoVariants}
									initial="initial"
									animate="animate"
									exit="exit"
									transition={{duration: 0.2, ease: "linear"}}
								>
									<span className="uppercase mr-1">{activeInfo.title}:</span>
									{activeInfo.body}
								</motion.a>
							</AnimatePresence>
						</div>
					</div>
				</div>
			</div>
		</motion.div>
	);
}

function LogoWhite({className}: { className?: string }) {
	return (
		<svg className={cn(className)} width="62"
		     height="35" viewBox="0 0 62 35" fill="none" xmlns="http://www.w3.org/2000/svg">
			<path
				d="M17.4111 0C22.3154 0 26.7456 2.02833 29.9102 5.29102C29.5823 5.47448 29.2582 5.66565 28.9404 5.86914C28.1476 6.37684 27.3648 6.88769 26.5928 7.40234C26.7527 7.36064 26.92 7.32284 27.0938 7.28809C27.2675 7.25336 27.4415 7.23536 27.6152 7.23535C27.9001 7.2354 28.1015 7.31962 28.2197 7.48633C28.3378 7.64617 28.3974 7.85809 28.3975 8.12207C28.3975 8.28893 28.3767 8.47418 28.335 8.67578L27.5107 12.8174C27.2743 12.7687 27.0098 12.7441 26.7178 12.7441C25.8902 12.7442 25.0554 12.8906 24.2139 13.1826C23.3793 13.4747 22.5861 13.8818 21.835 14.4033C21.0839 14.9179 20.4124 15.5234 19.8213 16.2188C19.2372 16.9072 18.7744 17.6553 18.4336 18.4619C18.0928 19.2687 17.9219 20.1006 17.9219 20.9561C17.9219 22.0341 18.2251 22.8763 18.8301 23.4814C19.4421 24.0793 20.2837 24.3779 21.3545 24.3779C21.8274 24.3779 22.3109 24.2844 22.8047 24.0967C23.2985 23.9089 23.7791 23.6795 24.2451 23.4082C24.7111 23.137 25.1388 22.8792 25.5283 22.6357C25.5005 22.7607 25.4759 22.8896 25.4551 23.0215C25.4343 23.1534 25.4239 23.2861 25.4238 23.418C25.4238 23.7795 25.5288 24.0204 25.7373 24.1387C25.9458 24.2637 26.2135 24.3261 26.54 24.3262C26.9504 24.3262 27.3441 24.2355 27.7197 24.0547C28.102 23.8739 28.4669 23.6547 28.8145 23.3975C29.1691 23.1402 29.5035 22.9003 29.8164 22.6777C29.5939 22.7264 29.3644 22.751 29.1279 22.751C28.7732 22.751 28.4947 22.6773 28.293 22.5312C28.0985 22.3851 28.001 22.1243 28.001 21.749C28.001 21.617 28.0076 21.4846 28.0215 21.3525C28.0423 21.2205 28.0669 21.0881 28.0947 20.9561L31.0078 6.53613C33.3944 9.51596 34.8232 13.2965 34.8232 17.4111C34.8232 21.4411 33.4528 25.1509 31.1543 28.1016C30.4614 27.5838 29.6014 27.2774 28.6699 27.2773C26.3752 27.2773 24.5146 29.1379 24.5146 31.4326C24.5147 32.0419 24.6462 32.6203 24.8818 33.1416C22.6179 34.2187 20.0851 34.8232 17.4111 34.8232C13.1934 34.8232 9.32648 33.3224 6.31348 30.8271C6.5155 30.7585 6.71619 30.6762 6.91406 30.5762C7.54694 30.2632 8.13807 29.842 8.6875 29.3135C9.24389 28.7918 9.74152 28.2073 10.1797 27.5605C10.6248 26.9138 10.9968 26.2527 11.2959 25.5781C11.5949 24.9036 11.8074 24.267 11.9326 23.6689C12.2526 22.1109 12.5726 20.5484 12.8926 18.9834C13.2125 17.4186 13.5326 15.8567 13.8525 14.2988H15.8975C16.0296 14.2988 16.1863 14.2469 16.3672 14.1426C16.555 14.0382 16.7325 13.923 16.8994 13.7979C17.0731 13.6658 17.2121 13.558 17.3164 13.4746C17.4833 13.3425 17.6684 13.2037 17.8701 13.0576C18.0787 12.9047 18.2837 12.7932 18.4854 12.7236H14.1758C14.3218 11.9726 14.4682 11.2038 14.6143 10.418C14.7672 9.63226 14.9826 8.87366 15.2607 8.14355C15.5389 7.40642 15.9498 6.74152 16.4922 6.15039C16.6939 6.09475 16.896 6.05981 17.0977 6.0459C17.3063 6.02504 17.515 6.01465 17.7236 6.01465C17.8209 6.01465 17.9913 6.03928 18.2344 6.08789C18.4777 6.13656 18.7357 6.20554 19.0068 6.2959C19.2779 6.37931 19.5076 6.47388 19.6953 6.57812C19.8899 6.68236 19.9871 6.79399 19.9873 6.91211C19.9872 6.96766 19.9427 7.03402 19.8525 7.11035C19.7691 7.17985 19.7058 7.22803 19.6641 7.25586C19.7893 7.22804 20.0055 7.13838 20.3115 6.98535C20.6175 6.83237 20.9405 6.65097 21.2812 6.44238C21.6288 6.23385 21.9246 6.02874 22.168 5.82715C22.4182 5.62556 22.5438 5.46869 22.5439 5.35742C22.5438 5.22547 22.4501 5.10333 22.2627 4.99219C22.0749 4.88095 21.8482 4.78645 21.584 4.70996C21.3198 4.62656 21.0656 4.56417 20.8223 4.52246C20.579 4.48077 20.4013 4.45996 20.29 4.45996C19.706 4.46001 19.1287 4.56771 18.5586 4.7832C17.9953 4.99878 17.4664 5.25287 16.9727 5.54492C16.2006 6.00398 15.5529 6.42885 15.0312 6.81836C14.51 7.20067 14.079 7.59013 13.7383 7.98633C13.4045 8.37574 13.1259 8.80744 12.9033 9.28027C12.6877 9.74624 12.4998 10.293 12.3398 10.9189C12.1799 11.5447 12.0165 12.2855 11.8496 13.1406L10.1484 14.2988H11.5889L9.67871 23.877C9.47704 24.8784 9.22014 25.8596 8.90723 26.8193C8.59423 27.7861 8.11363 28.6802 7.4668 29.501H7.38379C7.25166 29.501 7.12603 29.466 7.00781 29.3965C6.88297 29.3338 6.82031 29.226 6.82031 29.0732C6.82043 28.9483 6.86201 28.8299 6.94531 28.7188C7.02872 28.6076 7.1157 28.5168 7.20605 28.4473C7.04611 28.5585 6.80992 28.6946 6.49707 28.8545C6.18412 29.0214 5.86018 29.2018 5.52637 29.3965C5.36009 29.4915 5.20595 29.5881 5.06445 29.6865C1.93469 26.5386 0 22.2009 0 17.4111C0.000143279 7.79529 7.79529 0.000143289 17.4111 0ZM24.0566 14.2783C24.6548 14.2783 25.2119 14.4143 25.7266 14.6855C26.2481 14.9568 26.6344 15.3781 26.8848 15.9482L25.7471 21.6445C25.7054 21.8392 25.5597 22.0273 25.3096 22.208C25.0592 22.3889 24.7835 22.538 24.4844 22.6562C24.1923 22.7675 23.9524 22.8232 23.7646 22.8232C22.6519 22.8232 21.8238 22.5145 21.2812 21.8955C20.7388 21.2695 20.4678 20.4168 20.4678 19.3389C20.4678 18.7964 20.5301 18.2288 20.6553 17.6377C20.7874 17.0467 20.9933 16.4969 21.2715 15.9893C21.5566 15.4819 21.9252 15.0717 22.377 14.7588C22.8359 14.4389 23.3961 14.2784 24.0566 14.2783Z"
				fill="white"/>
			<path
				d="M32.1319 31.4322C32.1319 33.3445 30.5817 34.8947 28.6694 34.8947C26.7571 34.8947 25.2069 33.3445 25.2069 31.4322C25.2069 29.5199 26.7571 27.9697 28.6694 27.9697C30.5817 27.9697 32.1319 29.5199 32.1319 31.4322Z"
				fill="white"/>
			<path
				d="M50.8146 34.6424V27.8614H52.5771L52.752 28.7359C52.9673 28.422 53.2498 28.1708 53.5996 27.9825C53.9584 27.7941 54.371 27.7 54.8374 27.7C55.1693 27.7 55.4697 27.7448 55.7388 27.8345C56.0079 27.9152 56.2456 28.0408 56.4519 28.2112C56.6582 28.3727 56.8286 28.579 56.9632 28.8301C57.2233 28.4803 57.5552 28.2067 57.9588 28.0094C58.3624 27.8031 58.8019 27.7 59.2773 27.7C59.8872 27.7 60.3895 27.821 60.7842 28.0632C61.1878 28.3054 61.4883 28.6552 61.6856 29.1126C61.8829 29.5701 61.9816 30.1262 61.9816 30.781V34.6424H59.9769V30.9559C59.9769 30.4626 59.8783 30.0814 59.6809 29.8123C59.4926 29.5342 59.1876 29.3952 58.766 29.3952C58.497 29.3952 58.2593 29.4625 58.053 29.597C57.8467 29.7315 57.6852 29.9199 57.5686 30.1621C57.461 30.4043 57.4072 30.6958 57.4072 31.0366V34.6424H55.4025V30.9559C55.4025 30.4626 55.3038 30.0814 55.1065 29.8123C54.9092 29.5342 54.5907 29.3952 54.1512 29.3952C53.9001 29.3952 53.6714 29.4625 53.4651 29.597C53.2677 29.7315 53.1108 29.9199 52.9942 30.1621C52.8865 30.4043 52.8327 30.6958 52.8327 31.0366V34.6424H50.8146Z"
				fill="white"/>
			<path
				d="M45.793 34.8038C45.1382 34.8038 44.5507 34.6513 44.0304 34.3464C43.5102 34.0414 43.0976 33.6243 42.7927 33.0951C42.4877 32.5569 42.3352 31.947 42.3352 31.2653C42.3352 30.5657 42.4877 29.9513 42.7927 29.4221C43.0976 28.8839 43.5102 28.4624 44.0304 28.1574C44.5596 27.8524 45.1471 27.7 45.793 27.7C46.4567 27.7 47.0487 27.8524 47.5689 28.1574C48.0891 28.4624 48.5017 28.8839 48.8067 29.4221C49.1117 29.9513 49.2641 30.5612 49.2641 31.2519C49.2641 31.9425 49.1117 32.5569 48.8067 33.0951C48.5017 33.6243 48.0891 34.0414 47.5689 34.3464C47.0487 34.6513 46.4567 34.8038 45.793 34.8038ZM45.793 33.0547C46.062 33.0547 46.2997 32.9875 46.506 32.8529C46.7213 32.7184 46.8917 32.5166 47.0173 32.2475C47.1429 31.9784 47.2056 31.6465 47.2056 31.2519C47.2056 30.8572 47.1429 30.5253 47.0173 30.2563C46.8917 29.9872 46.7258 29.7854 46.5195 29.6508C46.3132 29.5163 46.0755 29.449 45.8064 29.449C45.5373 29.449 45.2951 29.5163 45.0799 29.6508C44.8736 29.7854 44.7076 29.9872 44.5821 30.2563C44.4565 30.5253 44.3937 30.8572 44.3937 31.2519C44.3937 31.6465 44.4565 31.9784 44.5821 32.2475C44.7076 32.5166 44.8736 32.7184 45.0799 32.8529C45.2951 32.9875 45.5328 33.0547 45.793 33.0547Z"
				fill="white"/>
			<path
				d="M37.5833 34.8038C36.8837 34.8038 36.2648 34.6513 35.7266 34.3464C35.1974 34.0414 34.7803 33.6243 34.4754 33.0951C34.1794 32.5659 34.0314 31.9605 34.0314 31.2788C34.0314 30.5792 34.1794 29.9648 34.4754 29.4356C34.7803 28.8974 35.1974 28.4758 35.7266 28.1708C36.2648 27.8569 36.8837 27.7 37.5833 27.7C38.4713 27.7 39.2157 27.9332 39.8167 28.3996C40.4266 28.866 40.8123 29.5163 40.9738 30.3504H38.8345C38.7538 30.0634 38.6013 29.8392 38.3771 29.6777C38.1529 29.5163 37.8838 29.4356 37.5698 29.4356C37.2739 29.4356 37.0137 29.5118 36.7895 29.6643C36.5742 29.8078 36.4038 30.0186 36.2782 30.2966C36.1527 30.5657 36.0899 30.8841 36.0899 31.2519C36.0899 31.5299 36.1258 31.7811 36.1975 32.0053C36.2693 32.2296 36.3679 32.4224 36.4935 32.5838C36.628 32.7453 36.785 32.8709 36.9644 32.9606C37.1438 33.0413 37.3456 33.0817 37.5698 33.0817C37.7851 33.0817 37.9735 33.0458 38.1349 32.974C38.3053 32.9023 38.4489 32.7991 38.5655 32.6646C38.691 32.53 38.7807 32.3641 38.8345 32.1668H40.9738C40.8123 32.974 40.4266 33.6153 39.8167 34.0907C39.2068 34.5661 38.4623 34.8038 37.5833 34.8038Z"
				fill="white"/>
		</svg>
	);
}

export default FlashInfo;